<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SR WorkRoom - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0c10;
      --surface:#121317;
      --surface-2:#17181e;
      --text:#ffffff;
      --sub:#cfd3da;
      --accent:#00f2fe;
      --accent-2:#8a2be2;
      --radius:14px;
      --line:#242836;
      --glow:0 0 30px rgba(0,242,254,.25);
      --density:1;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family:'Prompt',sans-serif;
      background: radial-gradient(1200px 600px at 10% -10%, #1b2b34 0%, transparent 60%),
                  radial-gradient(900px 600px at 100% 0%, #241b3a 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    /* ===== Top nav (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ===== */
    .nav{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(15,15,18,.85), rgba(15,15,18,.55));
      border-bottom:1px solid #22262e;
    }
    .nav-wrap{
      max-width:1200px; margin:0 auto; padding:14px 20px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .badge{
      border:2px solid var(--accent); border-radius:10px; padding:6px 10px;
      background:linear-gradient(90deg,#00f2fe22,#8a2be222); box-shadow:var(--glow);
      font-weight:700;
    }
    .nav-left{display:flex; align-items:center; gap:10px}
    .btn{
      appearance:none; border:none; cursor:pointer; font-weight:600;
      padding: calc(10px * var(--density)) calc(16px * var(--density));
      border-radius:12px; transition:.25s;
    }
    .btn.ghost{background:transparent; color:var(--sub); border:1px solid #2a2f38}
    .btn.ghost:hover{border-color:#3a404b; color:#fff}
    .btn.primary{color:#000; background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .btn.primary:hover{transform:translateY(-1px)}

    /* ===== Sections (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ===== */
    .hero{
      max-width:1200px; margin:0 auto; padding:56px 20px 28px;
      display:grid; grid-template-columns: 1.1fr .9fr; gap:28px; align-items:center;
    }
    .hero h1{font-size:42px; line-height:1.15; margin:0 0 12px}
    .hero p{color:var(--sub); font-size:18px; margin:0 0 22px}
    .hero .cta{display:flex; gap:12px; flex-wrap:wrap}
    .hero-card{
      background:linear-gradient(180deg,#16171d,#121317);
      border:1px solid var(--line); border-radius:var(--radius); padding:22px;
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
    }

    .section{max-width:1200px; margin:14px auto 60px; padding:0 20px}
    .section h2{font-size:24px; margin:0 0 16px}
    .grid{
      display:grid; gap:18px;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    }
    .card{
      background: linear-gradient(180deg, var(--surface-2), var(--surface));
      border:1px solid var(--line); border-radius:var(--radius); padding:18px;
      transition:.25s; position:relative; overflow:hidden;
    }
    .card:hover{transform:translateY(-3px); box-shadow:var(--glow)}
    .card h3{margin:0 0 6px; font-size:18px}
    .card p{margin:0; color:#aeb4bf; font-size:14px}
    .pill-sec{display:inline-flex; align-items:center; gap:8px; font-size:12px; color:#9aa3b2;
      padding:6px 10px; border-radius:999px; border:1px solid #2b2f39; background:#171921}

    .week-grid{
      display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
    }
    .week{
      background: linear-gradient(180deg,#161922,#121317);
      border:1px solid #262b37; border-radius:var(--radius); padding:16px;
    }
    .week strong{display:block; margin-bottom:6px}
    .muted{color:#9aa3b2; font-size:14px}

    .room{cursor:pointer}
    .room .tag{
      display:inline-block; font-size:11px; color:#9aa3b2;
      border:1px solid #2b2f39; padding:4px 8px; border-radius:999px; margin-top:10px;
    }
    .empty{color:#9aa3b2; font-size:14px; border:1px dashed #2b2f39; border-radius:var(--radius); padding:16px; background:#101217}

    footer{border-top:1px solid #20242f; color:#7d8795; font-size:13px; padding:22px 20px; text-align:center}
    .container{max-width:1200px; margin:0 auto}

    /* ===== Drawer ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢: ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/Settings ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ===== */
    .drawer{
      position:fixed; inset:0 auto 0 0; width:340px; max-width:86vw;
      background:linear-gradient(180deg, var(--surface-2), var(--surface));
      border-right:1px solid var(--line);
      transform:translateX(-105%); transition:.35s ease;
      z-index:60; padding:16px;
      box-shadow:20px 0 40px rgba(0,0,0,.45);
    }
    .drawer.open{ transform:none; }
    .drawer-dim{
      position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; z-index:59;
    }
    .drawer.open + .drawer-dim{ display:block; }

    .acc-header{
      display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:14px;
    }
    .badge{
      border:2px solid var(--accent);
      border-radius:10px; padding:6px 10px;
      background:linear-gradient(90deg,#00f2fe22,#8a2be222);
      box-shadow:var(--glow);
      font-weight:700;
    }
    .acc-title{ font-weight:700; margin:16px 0 10px; font-size:14px; color:#d7dbe4; letter-spacing:.2px }

    .profile{
      display:grid; grid-template-columns:64px 1fr; gap:12px; align-items:center;
      background: #0f1219; border:1px solid #2b2f39; border-radius:12px; padding:12px;
    }
    .avatar{
      width:64px; height:64px; border-radius:50%; border:2px solid var(--accent);
      background:#0d0f14 center/cover no-repeat;
    }
    .profile .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:6px}
    .mini{font-size:12px; color:#9aa3b2}
    .field{margin:8px 0}
    .label{font-size:12px; color:#9aa3b2; margin-bottom:4px}
    .input, .select{
      width:100%; padding: calc(10px * var(--density)) calc(12px * var(--density));
      border-radius:10px; border:1px solid #2b2f39; background:#131722; color:#fff;
    }
    .color-pick{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .color-pick input[type="color"]{
      appearance:none; width:34px; height:34px; border-radius:8px; border:1px solid #2b2f39; padding:0; background:transparent
    }
    .range{ width:100% }
    .sep{height:1px; background:#1f2330; margin:12px 0}
  </style>
</head>
<body>

  <!-- ===== Top nav (‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î Drawer) ===== -->
  <header class="nav">
    <div class="nav-wrap">
      <div class="nav-left">
        <button class="btn ghost" id="openDrawer">‚ò∞ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
        <div class="badge">SR WorkRoom</div>
      </div>
      <div class="nav-actions">
        <button class="btn ghost" onclick="openJoin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î</button>
        <button class="btn ghost" onclick="window.location.href='create-room.html'">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
        <button class="btn primary" onclick="window.location.href='create-room.html'">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
        <button class="btn ghost" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </div>
  </header>

  <!-- ===== Drawer ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ/Settings ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ===== -->
  <aside id="drawer" class="drawer">
    <div class="acc-header">
      <div class="badge">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
      <button class="btn ghost" id="closeDrawer" title="‡∏õ‡∏¥‡∏î">‚úï</button>
    </div>

    <!-- ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
    <div class="acc-title">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
    <div class="profile">
      <div id="avatar" class="avatar"></div>
      <div>
        <div class="row">
          <label class="btn ghost" for="avatarInput">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ</label>
          <input id="avatarInput" type="file" accept="image/*" style="display:none">
        </div>
        <div class="mini">‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (Local)</div>
      </div>
    </div>
    <div class="field">
      <div class="label">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á</div>
      <input id="displayName" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠">
    </div>
    <div class="field">
      <div class="label">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô ‡πÜ</div>
      <input id="bio" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏µ‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå A / ‡∏ù‡πà‡∏≤‡∏¢‡∏ß‡∏¥‡∏à‡∏±‡∏¢">
    </div>
    <div class="row">
      <button class="btn primary" id="saveProfile">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
      <span id="profileSaved" class="mini" style="display:none">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì</span>
    </div>

    <div class="sep"></div>

    <!-- Settings -->
    <div class="acc-title">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
    <div class="field">
      <div class="label">‡∏™‡∏µ Accent</div>
      <div class="color-pick">
        <input id="accent" type="color" value="#00f2fe" title="Accent 1">
        <input id="accent2" type="color" value="#8a2be2" title="Accent 2">
        <button class="btn primary" type="button">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
      </div>
    </div>
    <div class="field">
      <div class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏∏‡∏° (Radius)</div>
      <input id="radius" class="range" type="range" min="6" max="22" value="14">
    </div>
    <div class="field">
      <div class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (Compact)</div>
      <input id="density" class="range" type="range" min="0.85" max="1.15" step="0.01" value="1">
      <div class="mini">‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°/‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô</div>
    </div>
    <div class="row">
      <button class="btn ghost" id="resetTheme">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      <button class="btn primary" id="saveTheme">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      <span id="themeSaved" class="mini" style="display:none">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì</span>
    </div>

    <div class="sep"></div>
    <button class="btn ghost" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  </aside>
  <div id="drawerDim" class="drawer-dim"></div>

  <!-- ===== ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Dashboard (‡πÑ‡∏°‡πà‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ã‡πâ‡∏≤‡∏¢) ===== -->
  <section class="hero">
    <div>
      <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡∏° <br>‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á</h1>
      <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡∏ß‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á ‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‚Äî‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•‡πÅ‡∏•‡∏∞‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢</p>
      <div class="cta">
        <button class="btn primary" onclick="window.location.href='create-room.html'">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        <button class="btn ghost" onclick="openJoin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î</button>
      </div>
    </div>
    <div class="hero-card">
      <h3>‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
      <p>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á ‚Äú‡∏´‡πâ‡∏≠‡∏á‡∏á‡∏≤‡∏ô‚Äù ‚Äú‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‚Äù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÅ‡∏•‡∏∞‡∏™‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
    </div>
  </section>

  <section id="this-week" class="section">
    <div class="pill-sec">This week</div>
    <h2 style="margin-top:10px">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</h2>
    <div class="week-grid" id="weekGrid"></div>
  </section>

  <section class="section">
    <h2>‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
    <div id="roomGrid" class="grid"></div>
    <div id="roomEmpty" class="empty" style="display:none;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° ‚Äî ‡∏•‡∏≠‡∏á‡∏Å‡∏î ‚Äú+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‚Äù ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
  </section>

  <footer>
    <div class="container">¬© 2025 SR WorkRoom ‚Ä¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°</div>
  </footer>

  <!-- Modal Join -->
  <div id="joinModal" style="position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:70;">
    <div style="width:100%; max-width:440px; background:linear-gradient(180deg,var(--surface-2),var(--surface)); border:1px solid var(--line); border-radius:16px; padding:20px;">
      <h3 style="margin:0 0 10px">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î</h3>
      <div class="field"><input id="joinCode" class="input" type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ABC123" /></div>
      <div class="row" style="margin-top:12px; justify-content:flex-end">
        <button class="btn ghost" onclick="closeJoin()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn primary" onclick="joinLocal()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡πÅ‡∏ö‡∏ö‡πÇ‡∏•‡∏Ñ‡∏±‡∏•)</button>
      </div>
    </div>
  </div>

<script>
  /* ===== Utilities ===== */
  const $ = id => document.getElementById(id);
  const setVar = (k,v)=> document.documentElement.style.setProperty(k,v);
  const normalize = s => (s||'').toString().trim().toUpperCase().replace(/[^A-Z0-9]/g,'');

  /* ===== Drawer toggle ===== */
  const drawer = $('drawer'), dim = $('drawerDim');
  $('openDrawer').addEventListener('click', ()=> drawer.classList.add('open'));
  $('closeDrawer').addEventListener('click', ()=> drawer.classList.remove('open'));
  dim.addEventListener('click', ()=> drawer.classList.remove('open'));

  /* ===== Logout ===== */
  function logout(){
    try{
      localStorage.removeItem('currentUser');
      localStorage.removeItem('lastRoom');
    }catch(e){}
    window.location.href = 'index.html';
  }

  /* ===== Profile state ===== */
  const K_PROFILE = 'profile';
  function loadProfile(){
    try{
      const p = JSON.parse(localStorage.getItem(K_PROFILE) || '{}');
      if(p.name) $('displayName').value = p.name;
      if(p.bio) $('bio').value = p.bio;
      if(p.avatar) $('avatar').style.backgroundImage = `url('${p.avatar}')`;
    }catch(e){}
  }
  function saveProfile(){
    const name = $('displayName').value.trim();
    const bio  = $('bio').value.trim();
    const bg   = $('avatar').style.backgroundImage || '';
    const avatar = bg.startsWith('url(') ? bg.slice(5,-2) : '';
    localStorage.setItem(K_PROFILE, JSON.stringify({ name, bio, avatar }));
    $('profileSaved').style.display = 'inline';
    setTimeout(()=> $('profileSaved').style.display='none', 1200);
  }
  $('saveProfile').addEventListener('click', saveProfile);
  $('avatarInput').addEventListener('change', (e)=>{
    const f = e.target.files?.[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{ $('avatar').style.backgroundImage = `url('${r.result}')`; };
    r.readAsDataURL(f);
  });
  loadProfile();

  /* ===== Theme (personalization) ===== */
  const K_THEME = 'themePrefs';
  function applyTheme(t){
    if(!t) return;
    if(t.accent) setVar('--accent', t.accent);
    if(t.accent2) setVar('--accent-2', t.accent2);
    if(t.radius) setVar('--radius', t.radius + 'px');
    if(t.density) setVar('--density', t.density);
    // sync controls
    if($('accent')) $('accent').value = t.accent || '#00f2fe';
    if($('accent2')) $('accent2').value = t.accent2 || '#8a2be2';
    if($('radius')) $('radius').value = t.radius || 14;
    if($('density')) $('density').value = t.density || 1;
  }
  function loadTheme(){
    try{
      const t = JSON.parse(localStorage.getItem(K_THEME) || '{}');
      if(!t.accent) t.accent = '#00f2fe';
      if(!t.accent2) t.accent2 = '#8a2be2';
      if(!t.radius) t.radius = 14;
      if(!t.density) t.density = 1;
      applyTheme(t);
    }catch(e){}
  }
  function currentThemeFromControls(){
    return {
      accent: $('accent').value,
      accent2: $('accent2').value,
      radius: parseInt($('radius').value,10),
      density: parseFloat($('density').value)
    };
  }
  function saveTheme(){
    const t = currentThemeFromControls();
    localStorage.setItem(K_THEME, JSON.stringify(t));
    applyTheme(t);
    $('themeSaved').style.display = 'inline';
    setTimeout(()=> $('themeSaved').style.display='none', 1200);
  }
  function resetTheme(){
    const t = { accent:'#00f2fe', accent2:'#8a2be2', radius:14, density:1 };
    localStorage.setItem(K_THEME, JSON.stringify(t));
    applyTheme(t);
  }
  $('saveTheme').addEventListener('click', saveTheme);
  $('resetTheme').addEventListener('click', resetTheme);
  loadTheme();

  /* ===== Join (local) ‡πÄ‡∏î‡∏¥‡∏° ===== */
  function openJoin(){ $('joinModal').style.display='flex'; $('joinCode').value=''; setTimeout(()=>$('joinCode').focus(),50); }
  function closeJoin(){ $('joinModal').style.display='none'; }
  function joinLocal(){
    const code = normalize($('joinCode').value);
    if(!code){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô'); return; }
    const rooms = JSON.parse(localStorage.getItem('rooms')||'[]');
    const found = rooms.find(r => normalize(r.code)===code);
    if(!found){ alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ'); return; }
    localStorage.setItem('lastRoom', JSON.stringify({ ...found, role:'member' }));
    closeJoin();
    location.href = 'room.html';
  }
  window.openJoin = openJoin;
  window.closeJoin = closeJoin;
  window.joinLocal = joinLocal;

  /* ===== Rooms render (‡πÄ‡∏î‡∏¥‡∏°) ===== */
  const roomGrid = $('roomGrid');
  const roomEmpty = $('roomEmpty');
  const rooms = JSON.parse(localStorage.getItem('rooms')) || [];
  if(rooms.length === 0){
    roomEmpty.style.display = 'block';
  }else{
    roomGrid.innerHTML = rooms.map((r,idx)=> `
      <div class="card room" onclick="openRoom(${idx})">
        <h3>${r.name}</h3>
        <p>${r.detail || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
        <span class="tag">${r.type || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</span>
      </div>
    `).join('');
  }
  function openRoom(index){
    const selected = rooms[index];
    const currentUser = localStorage.getItem('currentUser') || 'me';
    const K_MEMBERS = `members_${selected.name}`;
    const members = JSON.parse(localStorage.getItem(K_MEMBERS) || '[]');
    const me = members.find(m=>m.name===currentUser);
    const role = (me && me.role) || (selected.createdBy===currentUser ? 'host' : 'member');
    localStorage.setItem('lastRoom', JSON.stringify({...selected, role}));
    window.location.href = 'room.html';
  }
  window.openRoom = openRoom;

  /* ===== This week (‡πÄ‡∏î‡∏¥‡∏°) ===== */
  const weekGrid = $('weekGrid');
  function isThisWeek(dateStr){
    if(!dateStr) return false;
    const d = new Date(dateStr);
    if(isNaN(d)) return false;
    const now = new Date();
    const start = new Date(now);
    start.setDate(now.getDate() - now.getDay()); // ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å
    start.setHours(0,0,0,0);
    const end = new Date(start); end.setDate(start.getDate() + 7);
    return d >= start && d < end;
  }
  function collectThisWeek(){
    const items = [];
    Object.keys(localStorage).forEach(key=>{
      if(key.startsWith('assignments_')){
        const roomName = key.replace('assignments_','');
        try{
          const arr = JSON.parse(localStorage.getItem(key) || '[]');
          arr.forEach(a=>{
            if(a && a.due && isThisWeek(a.due)){
              items.push({type:'deadline', title:a.title||'(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)', date:a.due, room:roomName});
            }
          });
        }catch(e){}
      }
    });
    Object.keys(localStorage).forEach(key=>{
      if(key.startsWith('events_')){
        const roomName = key.replace('events_','');
        try{
          const arr = JSON.parse(localStorage.getItem(key) || '[]');
          arr.forEach(ev=>{
            if(ev && ev.date && isThisWeek(ev.date)){
              items.push({type:'event', title:ev.title||'(Event)', date:ev.date, room:roomName});
            }
          });
        }catch(e){}
      }
    });
    items.sort((a,b)=> new Date(a.date) - new Date(b.date));
    return items;
  }
  function renderThisWeek(){
    const items = collectThisWeek();
    if(items.length === 0){
      weekGrid.innerHTML = `
        <div class="week">
          <strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</strong>
          <div class="muted">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô/‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
        </div>`;
      return;
    }
    weekGrid.innerHTML = items.map(it => `
      <div class="week">
        <strong>${it.type==='deadline' ? 'üìå ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á' : 'üìÖ ‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå'} ‚Äî ${it.title}</strong>
        <div class="muted">‡∏´‡πâ‡∏≠‡∏á: ${it.room || '-'}</div>
        <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${it.date}</div>
      </div>
    `).join('');
  }
  renderThisWeek();
</script>
</body>
</html>
